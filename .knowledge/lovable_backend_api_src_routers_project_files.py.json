{"is_source_file": true, "format": "Python", "description": "This source file defines FastAPI HTTP route handlers for managing project files, including listing, creating, updating, retrieving, deleting files, and handling project version snapshots and project export functionality. It leverages dependency injection, data validation via Pydantic models, and interacts with project file services and preview services.", "external_files": ["src.routers.auth", "src.services.project_files_service", "src.services.preview_service"], "external_methods": ["get_current_user", "project_files_service.list_files", "project_files_service.upsert_file_by_path", "project_files_service.get_file", "project_files_service.update_file", "project_files_service.delete_file", "project_files_service.snapshot_version", "project_files_service.list_versions", "project_files_service.restore_version", "project_files_service.export_zip_bytes", "preview_service.broadcast_reload"], "published": ["list_project_files", "create_or_update_file", "get_file", "update_file", "delete_file", "create_version", "list_versions", "restore_version", "export_project_zip"], "classes": [{"name": "ProjectFileBase", "description": "Pydantic model defining common basic file fields such as path, content, and is_binary flag."}, {"name": "ProjectFileCreate", "description": "Pydantic model inheriting from ProjectFileBase, used for creating or upserting project files."}, {"name": "ProjectFileUpdate", "description": "Pydantic model for partial updates to a project file, fields are optional."}, {"name": "ProjectFileOut", "description": "Pydantic model representing the file object returned by API with ID, path, content, and binary flag."}, {"name": "VersionCreate", "description": "Pydantic model for payload to create a new version snapshot."}, {"name": "VersionOut", "description": "Pydantic model representing version information."}], "methods": [{"name": "ProjectFileOut _to_out(rec: FileRecord)", "description": "Converts a FileRecord to a ProjectFileOut model.", "scope": "", "scopeKind": ""}, {"name": "List[ProjectFileOut] list_project_files( project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "GET endpoint to list all project files.", "scope": "", "scopeKind": ""}, {"name": "ProjectFileOut create_or_update_file( payload: ProjectFileCreate, project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "POST endpoint to create or update a project file.", "scope": "", "scopeKind": ""}, {"name": "ProjectFileOut get_file( file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "GET endpoint to retrieve a specific file by ID.", "scope": "", "scopeKind": ""}, {"name": "ProjectFileOut update_file( payload: ProjectFileUpdate, file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "PATCH endpoint to update file attributes by ID.", "scope": "", "scopeKind": ""}, {"name": "None delete_file( file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "DELETE endpoint to remove a file by ID.", "scope": "", "scopeKind": ""}, {"name": "VersionOut create_version( payload: VersionCreate, project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "POST endpoint to snapshot current project files into a new version.", "scope": "", "scopeKind": ""}, {"name": "List[VersionOut] list_versions( project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "GET endpoint to list all project versions.", "scope": "", "scopeKind": ""}, {"name": "List[ProjectFileOut] restore_version( version_number: int = Path(..., description=\"Version number to restore\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )", "description": "POST endpoint to restore project files from a specific version.", "scope": "", "scopeKind": ""}, {"name": "export_project_zip( project_id: str = Path(..., description=\"Project ID\"), download: Optional[bool] = Query(default=True, description=\"Whether to prompt download via Content-Disposition\"), current_user: UserPublic = Depends(get_current_user), )", "description": "GET endpoint to export the project files as a ZIP stream.", "scope": "", "scopeKind": ""}, {"name": "VersionOut _to_version_out(v: VersionRecord)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["project_files_service.list_files", "project_files_service.upsert_file_by_path", "project_files_service.get_file", "project_files_service.update_file", "project_files_service.delete_file", "project_files_service.snapshot_version", "project_files_service.list_versions", "project_files_service.restore_version", "project_files_service.export_zip_bytes", "preview_service.broadcast_reload"], "search-terms": ["project files", "file management", "version control", "file router", "project export", "file CRUD", "file snapshot", "ZIP project files"], "state": 2, "file_id": 16, "knowledge_revision": 52, "git_revision": "4d6116c3744385755434bf99b2a4f1d34b9385fe", "revision_history": [{"41": "e2d3cd320e4aa05744e2bf09aa293f2f9c24663d"}, {"52": "4d6116c3744385755434bf99b2a4f1d34b9385fe"}], "ctags": [{"_type": "tag", "name": "ProjectFileBase", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class ProjectFileBase(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProjectFileCreate", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class ProjectFileCreate(ProjectFileBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProjectFileOut", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class ProjectFileOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProjectFileUpdate", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class ProjectFileUpdate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VersionCreate", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class VersionCreate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VersionOut", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^class VersionOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_to_out", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^def _to_out(rec: FileRecord) -> ProjectFileOut:$/", "language": "Python", "typeref": "typename:ProjectFileOut", "kind": "function", "signature": "(rec: FileRecord)"}, {"_type": "tag", "name": "_to_version_out", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^def _to_version_out(v: VersionRecord) -> VersionOut:$/", "language": "Python", "typeref": "typename:VersionOut", "kind": "function", "signature": "(v: VersionRecord)"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    content: Optional[str] = Field(None, description=\"New file content\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ProjectFileUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    content: str = Field(..., description=\"Content\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ProjectFileOut", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    content: str = Field(..., description=\"File contents as text\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ProjectFileBase", "scopeKind": "class"}, {"_type": "tag", "name": "create_or_update_file", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def create_or_update_file($/", "language": "Python", "typeref": "typename:ProjectFileOut", "kind": "function", "signature": "( payload: ProjectFileCreate, project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "create_version", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def create_version($/", "language": "Python", "typeref": "typename:VersionOut", "kind": "function", "signature": "( payload: VersionCreate, project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "delete_file", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def delete_file($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    description: Optional[str] = Field(None, description=\"Description for the snapshot\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VersionCreate", "scopeKind": "class"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    description: Optional[str] = Field(None, description=\"Description\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VersionOut", "scopeKind": "class"}, {"_type": "tag", "name": "export_project_zip", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def export_project_zip($/", "language": "Python", "kind": "function", "signature": "( project_id: str = Path(..., description=\"Project ID\"), download: Optional[bool] = Query(default=True, description=\"Whether to prompt download via Content-Disposition\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "export_router", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^export_router = APIRouter($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_file", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def get_file($/", "language": "Python", "typeref": "typename:ProjectFileOut", "kind": "function", "signature": "( file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    id: str = Field(..., description=\"File ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ProjectFileOut", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    id: str = Field(..., description=\"Version ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VersionOut", "scopeKind": "class"}, {"_type": "tag", "name": "is_binary", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    is_binary: Optional[bool] = Field(None, description=\"New binary flag\")$/", "language": "Python", "typeref": "typename:Optional[bool]", "kind": "variable", "scope": "ProjectFileUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "is_binary", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    is_binary: bool = Field(False, description=\"Binary flag\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "ProjectFileOut", "scopeKind": "class"}, {"_type": "tag", "name": "is_binary", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    is_binary: bool = Field(False, description=\"Whether the file content is binary\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "ProjectFileBase", "scopeKind": "class"}, {"_type": "tag", "name": "list_project_files", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def list_project_files($/", "language": "Python", "typeref": "typename:List[ProjectFileOut]", "kind": "function", "signature": "( project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_versions", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def list_versions($/", "language": "Python", "typeref": "typename:List[VersionOut]", "kind": "function", "signature": "( project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    path: Optional[str] = Field(None, description=\"New file path\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "ProjectFileUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    path: str = Field(..., description=\"File path within the project (e.g., src\\/app\\/page.tsx)\"/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ProjectFileBase", "scopeKind": "class"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    path: str = Field(..., description=\"Path\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ProjectFileOut", "scopeKind": "class"}, {"_type": "tag", "name": "restore_version", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def restore_version($/", "language": "Python", "typeref": "typename:List[ProjectFileOut]", "kind": "function", "signature": "( version_number: int = Path(..., description=\"Version number to restore\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^router = APIRouter($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_file", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^async def update_file($/", "language": "Python", "typeref": "typename:ProjectFileOut", "kind": "function", "signature": "( payload: ProjectFileUpdate, file_id: str = Path(..., description=\"File ID\"), project_id: str = Path(..., description=\"Project ID\"), current_user: UserPublic = Depends(get_current_user), )"}, {"_type": "tag", "name": "version_number", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^    version_number: int = Field(..., description=\"Version number\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "VersionOut", "scopeKind": "class"}, {"_type": "tag", "name": "versions_router", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/project_files.py", "pattern": "/^versions_router = APIRouter($/", "language": "Python", "kind": "variable"}], "hash": "3d7a975f033060de9211a566a8f80c87", "format-version": 4, "code-base-name": "lovable_backend_api", "filename": "lovable_backend_api/src/routers/project_files.py", "fields": [{"name": "Optional[str] content", "scope": "ProjectFileUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "str content", "scope": "ProjectFileOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] description", "scope": "VersionCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "export_router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str id", "scope": "ProjectFileOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[bool] is_binary", "scope": "ProjectFileUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_binary", "scope": "ProjectFileOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] path", "scope": "ProjectFileUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "str path", "scope": "ProjectFileBase", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int version_number", "scope": "VersionOut", "scopeKind": "class", "description": "unavailable"}, {"name": "versions_router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}]}