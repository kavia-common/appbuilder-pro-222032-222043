{"is_source_file": true, "format": "Python", "description": "This file defines REST API endpoints and WebSocket handlers for initiating code generation tasks and streaming their events, primarily within a FastAPI application. It includes models for request and response payloads, dependency injection for user authentication, and logic for starting tasks and validating WebSocket connections.", "external_files": ["src.routers.auth", "src.services.generation_service"], "external_methods": ["get_current_user", "generation_service.create_task", "generation_service.run_task", "generation_service.get_task_owner", "generation_service.stream_events"], "published": [], "classes": [{"name": "GenerateRequest", "description": "Payload data model to initiate a generation task, containing the prompt, optional project ID, and chat session ID."}, {"name": "GenerateResponse", "description": "Response model containing the task ID and WebSocket URL for streaming generation events."}], "methods": [{"name": "GenerateResponse start_generation( payload: GenerateRequest, current_user: UserPublic = Depends(get_current_user), x_forwarded_proto: Optional[str] = Header(default=None), x_forwarded_host: Optional[str] = Header(default=None), )", "description": "API endpoint that initiates a generation task, returns the task ID and WebSocket URL.", "scope": "", "scopeKind": ""}, {"name": "None ws_stream_generation(websocket: WebSocket, task_id: str = Path(...))", "description": "WebSocket handler that validates authorization, confirms task ownership, and streams generation events to the client.", "scope": "", "scopeKind": ""}], "calls": ["generation_service.create_task", "generation_service.run_task", "generation_service.get_task_owner", "generation_service.stream_events"], "search-terms": ["WebSocket generation streaming", "FastAPI generate endpoint", "generation task", "streaming events", "authorization WebSocket"], "state": 2, "file_id": 14, "knowledge_revision": 37, "git_revision": "309001e7f7c7acfb21db7b53fa0dcb3d0b1f3a56", "revision_history": [{"35": ""}, {"37": "309001e7f7c7acfb21db7b53fa0dcb3d0b1f3a56"}], "ctags": [{"_type": "tag", "name": "GenerateRequest", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^class GenerateRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GenerateResponse", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^class GenerateResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "chat_session_id", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^    chat_session_id: Optional[str] = Field(None, description=\"Associated chat session ID\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "GenerateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "project_id", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^    project_id: Optional[str] = Field(None, description=\"Target project ID\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "GenerateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "prompt", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^    prompt: str = Field(..., description=\"Natural language requirement or change request\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GenerateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^router = APIRouter($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "start_generation", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^async def start_generation($/", "language": "Python", "typeref": "typename:GenerateResponse", "kind": "function", "signature": "( payload: GenerateRequest, current_user: UserPublic = Depends(get_current_user), x_forwarded_proto: Optional[str] = Header(default=None), x_forwarded_host: Optional[str] = Header(default=None), )"}, {"_type": "tag", "name": "task_id", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^    task_id: str = Field(..., description=\"ID of the generation task; connect to WS to stream ev/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GenerateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "websocket_url", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^    websocket_url: str = Field(..., description=\"WebSocket URL to stream generation events\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GenerateResponse", "scopeKind": "class"}, {"_type": "tag", "name": "ws_stream_generation", "path": "/home/kavia/workspace/code-generation/appbuilder-pro-222032-222043/lovable_backend_api/src/routers/generate.py", "pattern": "/^async def ws_stream_generation(websocket: WebSocket, task_id: str = Path(...)) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(websocket: WebSocket, task_id: str = Path(...))"}], "hash": "dc9e31d0243190ce0b87f42bb9945d9b", "format-version": 4, "code-base-name": "lovable_backend_api", "filename": "lovable_backend_api/src/routers/generate.py", "fields": [{"name": "Optional[str] chat_session_id", "scope": "GenerateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] project_id", "scope": "GenerateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str prompt", "scope": "GenerateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str task_id", "scope": "GenerateResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str websocket_url", "scope": "GenerateResponse", "scopeKind": "class", "description": "unavailable"}]}